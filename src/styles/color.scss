@use "sass:map";
@use "sass:color";
@use "sass:list";

$tones: 0, 5, 8, 10, 15, 20, 25, 30, 35, 40, 50, 60, 70, 80, 90, 95, 98, 99, 100;

@function tonal-palette($key) {
  $out: ();

  @each $tone in $tones {
    $color: color.change($key, $lightness: $tone * 1%);
    $out: map.set($out, $tone, $color);
  }

  @return $out;
}

$elevation-weights: 5%, 8%, 11%, 12%, 14%;

@function surface-elevations($surface, $overlay) {
  $out: ();

  @each $weight in $elevation-weights {
    $out: list.append($out, color.mix($overlay, $surface, $weight));
  }

  @return $out;
}

@mixin surface-elevation-vars($surface, $overlay) {
  $colors: surface-elevations($surface, $overlay);

  @for $i from 1 through length($colors) {
    $color: nth($colors, $i);

    --surface-elevation-#{$i}: #{$color};
  }
}

$light-tone: 40;
$dark-tone: 80;
$light-surface-tone: 98;
$dark-surface-tone: 10;

$palette: (
  neutral: tonal-palette(#000),
  primary: tonal-palette(#0400ff),
  secondary: tonal-palette(#3432b8),
  tertiary: tonal-palette(#236b38),
  error: tonal-palette(#f44336),
  warning: tonal-palette(#f7a829),
);

@each $name, $tones in $palette {
  :root {
    @each $tone, $color in $tones {
      --palette-#{$name}#{$tone}: #{$color};
    }
    
    --color-#{$name}: var(--palette-#{$name}#{$light-tone});
    --color-#{$name}-container: var(--palette-#{$name}90);
  }

  .dark {
    --color-#{$name}: var(--palette-#{$name}#{$dark-tone});
    --color-#{$name}-container: var(--palette-#{$name}30);
  }
}

:root {
  --color-background: var(--palette-neutral99);
  --color-on-background: var(--palette-neutral10);
  
  --color-surface: var(--palette-neutral#{$light-surface-tone});
  --color-on-surface: var(--palette-neutral10);

  --color-outline: var(--palette-neutral80);

  --color-text-muted: var(--palette-neutral50);

  --color-emphasis: var(--palette-secondary90);

  --cmp-blockquote-accent: var(--palette-neutral70);
  --cmp-code-background: var(--palette-neutral90);
  --cmp-li-bullet: var(--palette-neutral70);

  --cmp-search-background: var(--palette-neutral95);
  --cmp-search-background-focused: var(--palette-neutral90);
  --cmp-search-placeholder: var(--palette-neutral40);
  --cmp-search-icon: var(--palette-neutral60);

  --cmp-empty-background: var(--palette-neutral95);

  --cmp-navbar-indicator: var(--surface-elevation-3);

  --cmp-page-progress: var(--palette-primary60);

  --cmp-skeleton-background: var(--palette-neutral90);
  --cmp-skeleton-foreground: var(--palette-neutral95);

  --cmp-spinner-background: var(--palette-neutral80);
  --cmp-spinner-foreground: var(--palette-neutral50);

  --cmp-article-list-background: var(--color-surface);

  --cmp-drawer-background: var(--color-surface);
  --cmp-drawer-foreground: var(--palette-on-surface);

  $primary: map.get($palette, "primary", $light-tone);
  $surface: map.get($palette, "neutral", $light-surface-tone);

  @include surface-elevation-vars($surface, $primary);
}

.dark {
  --color-background: var(--palette-neutral8);
  --color-on-background: var(--palette-neutral90);

  --color-surface: var(--palette-neutral#{$dark-surface-tone});
  --color-on-surface: var(--palette-neutral90);
  
  --color-outline: var(--palette-neutral30);

  --color-text-muted: var(--palette-neutral60);
  
  --color-emphasis: var(--palette-secondary30);
  
  --cmp-blockquote-accent: var(--palette-neutral30);
  --cmp-code-background: var(--palette-neutral20);
  --cmp-li-bullet: var(--palette-neutral30);
  
  --cmp-search-background: var(--palette-neutral20);
  --cmp-search-background-focused: var(--palette-neutral25);
  --cmp-search-placeholder: var(--palette-neutral70);
  --cmp-search-icon: var(--palette-neutral70);
  
  --cmp-empty-background: var(--palette-neutral20);
  
  --cmp-navbar-indicator: var(--surface-elevation-3);
  
  --cmp-page-progress: var(--palette-primary60);
  
  --cmp-skeleton-background: var(--palette-neutral20);
  --cmp-skeleton-foreground: var(--palette-neutral30);
  
  --cmp-spinner-background: var(--palette-neutral30);
  --cmp-spinner-foreground: var(--palette-neutral50);
  
  --cmp-article-list-background: var(--color-surface);

  --cmp-drawer-background: var(--color-surface);
  --cmp-drawer-foreground: var(--palette-on-surface);
  
  $primary: map.get($palette, "primary", $dark-tone);
  $surface: map.get($palette, "neutral", $dark-surface-tone);

  @include surface-elevation-vars($surface, $primary);
}
